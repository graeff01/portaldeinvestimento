<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investimentos Imobiliários | Portal de Investimento</title>
  <meta name="description" content="Seleção curada de imóveis com potencial de investimento: alto rendimento, aluguel, revenda e preço abaixo do mercado." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f0f12;--bg-soft:#17171c;--card:#1a1a20;--muted:#9aa0a6;--text:#f3f4f6;
      --brand:#ff9100;--brand-2:#ffb866;--ok:#22c55e;--warn:#ffa200;--danger:#ef4444;
      --chip:#22222a;--border:#2c362f;--shadow:0 10px 30px rgba(10, 10, 10, 0.35);
      --glass:rgba(10,10,14,.6); --wa:#25D366;

      --container:1200px;
      --padY:clamp(20px, 4vw, 36px);
      --padX:clamp(16px + env(safe-area-inset-left), 6vw, 28px);

      --thumb-ratio:16/9;
      --thumb-max-h:300px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:inherit;text-decoration:none}

    .container{max-width:var(--container);margin:0 auto;padding:var(--padY) var(--padX)}
    .container.narrow{max-width:860px}

    /* ===== NAVBAR simples (não-sticky) ===== */
    .barra-topo{position:static;background:transparent;border-bottom:1px solid transparent}
    .barra-conteudo{max-width:var(--container);margin:0 auto;padding:10px var(--padX);display:flex;justify-content:center;gap:22px;align-items:center}
    .link-barra{font-weight:600;font-size:14px;color:var(--muted);padding:8px 10px;border-radius:10px;transition:.2s color,.2s background}
    .link-barra:hover{color:var(--text);background:rgba(255,255,255,.05)}

    /* ===== HERO minimal ===== */
    header.hero{position:relative;border-bottom:1px solid var(--border);overflow:hidden;isolation:isolate}
    header.hero::after{
      content:"";position:absolute;inset:0;opacity:.10;pointer-events:none;
      background-image:linear-gradient(#ffffff12 1px,transparent 1px),
                       linear-gradient(90deg,#ffffff12 1px,transparent 1px);
      background-size:36px 36px;
    }
    .hero-wrap{padding-block: clamp(44px, 9vw, 88px) clamp(18px, 4vw, 28px); text-align:center}

    .headline{
      margin:0 0 12px;
      font-size:clamp(34px, 7.2vw, 56px);
      line-height:1.06;
      letter-spacing:-.02em;
      font-weight:800;
      text-align:center;
      margin-inline:auto;
      max-width:22ch;
    }
    .headline .line1,.headline .line2{display:block;white-space:nowrap}
    .headline-accent{background:linear-gradient(135deg,var(--brand),var(--brand-2));-webkit-background-clip:text;background-clip:text;color:transparent}
    @media (max-width:420px){ .headline{font-size:clamp(28px, 8vw, 40px);max-width:20ch} }

    .lead{margin:8px auto 16px;max-width:72ch;color:var(--muted);font-size:16px}

    /* CTAs lado a lado */
    .cta-row{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:12px;margin-top:10px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;box-shadow:var(--shadow);transition:.2s transform,.2s opacity}
    .btn:hover{transform:translateY(-1px);opacity:.95}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2))}
    .btn.ghost{background:transparent}
    .cta-row .btn{width:100%;display:flex;justify-content:center;align-items:center;min-height:48px;white-space:nowrap;line-height:1;padding:14px 16px}

    /* ===== CARD ===== */
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;transition:transform .18s ease, box-shadow .18s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 12px 36px rgba(34, 34, 34, 0.45)}

    .thumb{position:relative;width:100%;aspect-ratio:var(--thumb-ratio);max-height:var(--thumb-max-h);background:#0b0b0e;overflow:hidden;border-bottom:1px solid var(--border)}
    .thumb img{width:100%;height:100%;object-fit:cover;object-position:center;display:block}

    .labels{position:absolute;left:10px;right:10px;top:10px;display:flex;align-items:flex-start;justify-content:space-between;gap:10px;pointer-events:none}
    .label-left,.label-right{pointer-events:auto}
    .label-left{display:flex;gap:8px;flex-wrap:wrap;max-width:45%}
    .label-right{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end;max-width:55%}
    .badge{background:var(--glass);backdrop-filter:blur(8px);padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px;white-space:nowrap}
    .badge.ok{background:rgba(0,0,0,.7);color:var(--ok);border-color:#224e2f}
    .b{background:rgba(0,0,0,.55);border:1px solid var(--border);padding:6px 8px;border-radius:999px;font-size:11px;white-space:nowrap}

    .body{padding:14px}
    .h{display:block}
    .price{font-size:clamp(28px,6.5vw,40px);font-weight:800;letter-spacing:-.01em;margin:2px 0 6px;background:radial-gradient(120% 120% at 0% 0%,#ffffff,#d7c9ff00 70%);-webkit-background-clip:text;background-clip:text;color:#fff;text-shadow:0 0 22px rgba(147,102,255,.12)}
    .title{font-size:15px;line-height:1.25;font-weight:600;color:#e8e9ee;opacity:.95;margin:0 0 6px}
    .loc{font-size:12.5px;color:var(--muted);margin:4px 0 8px}

    .specs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .spec{background:var(--chip);border:1px solid var(--border);border-radius:12px;padding:8px 10px;text-align:center}
    .spec .label{display:block;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.04em;margin-bottom:2px}
    .spec .value{font-size:13px;font-weight:700}

    .returns{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
    .ret{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;position:relative}
    .ret:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(0,0,0,.35)}
    .ret .label{display:block;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
    .ret .value{font-size:16px;font-weight:800;margin-top:4px}
    .ret .bar{height:6px;width:100%;background:#0f0f13;border:1px solid var(--border);border-radius:999px;margin-top:8px;overflow:hidden}
    .ret .bar span{display:block;height:100%;width:0;transition:width .6s ease}
    .ret.good .value{color:var(--ok)} .ret.warn .value{color:var(--warn)} .ret.bad .value{color:var(--danger)}
    .ret.good .bar span{background:linear-gradient(90deg,#16a34a,#22c55e 60%,#86efac)}
    .ret.warn .bar span{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
    .ret.bad  .bar span{background:linear-gradient(90deg,#ef4444,#f87171)}
    .ret[data-tip]{position:relative}
    .ret[data-tip]:hover::after{content:attr(data-tip);position:absolute;left:50%;bottom:calc(100% + 6px);transform:translateX(-50%);background:#0b0b0f;border:1px solid var(--border);padding:6px 8px;border-radius:8px;font-size:12px;color:var(--text);box-shadow:var(--shadow);white-space:nowrap;z-index:2}

    .footer{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap;margin:12px auto 2px;width:100%}
    .footer .btn,.footer a.btn{flex:0 0 auto;min-width:140px;text-align:center}

    .btn.whats{background:linear-gradient(120deg,var(--wa),#2de26f 60%, var(--wa));border-color:#1fb85a;color:#0b2616;font-weight:700;position:relative;overflow:hidden;justify-content:center;text-align:center;padding-left:16px;padding-right:16px;box-shadow:0 10px 28px rgba(37,211,102,.32), var(--shadow)}
    .btn.whats svg{width:16px;height:16px}
    .btn.whats::after{content:"";position:absolute;inset:0;background:linear-gradient(110deg,transparent 0%,rgba(255,255,255,.35) 35%,rgba(255,255,255,.9) 50%,rgba(255,255,255,.35) 65%,transparent 100%);transform:translateX(-160%);animation:shimmer 1.6s ease-in-out infinite;pointer-events:none}
    @keyframes shimmer{0%{transform:translateX(-160%)}100%{transform:translateX(160%)}}

    /* FAB + Modal Calculadora */
    .fab{position:fixed;right:20px;bottom:20px;z-index:30;display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:var(--text);border:1px solid #b486098e;box-shadow:var(--shadow);cursor:pointer}
    .fab svg{width:18px;height:18px}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);opacity:0;pointer-events:none;transition:.2s opacity;z-index:39}
    .overlay.visible{opacity:1;pointer-events:auto}
    .calc{position:fixed;right:20px;bottom:20px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;width:340px;box-shadow:var(--shadow);z-index:40;transform:translateY(16px);opacity:0;pointer-events:none;transition:.2s transform,.2s opacity}
    .calc.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .calc h3{margin:0 0 6px;font-size:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .input, select{width:100%;padding:12px 12px;background:var(--bg-soft);border:1px solid var(--border);color:var(--text);border-radius:12px}

    .calc .result{margin-top:10px;padding:12px;background:var(--bg-soft);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow)}
    .calc .res-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .calc .result .ret{padding:10px}
    .calc .result .value{font-size:15px}
    .calc .note{margin-top:8px;font-size:13px;color:var(--muted)}

    /* ===== CARROSSEL ===== */
    .carrossel{position:relative;margin:26px 0 84px}
    /* === Cards mais largos e próximos das bordas (mobile) === */
@media (max-width: 720px){
  /* tira o acolchoamento lateral do .container só no carrossel */
  .carrossel-viewport{
    margin-inline: calc(-1 * var(--padX)); /* anula o padding do container */
    padding-inline: 5px;                  /* só 10px de respiro por lado */
  }
    .carrossel-track{
      display:flex; gap:5px; align-items:stretch;
      overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior:smooth;
      -webkit-overflow-scrolling:touch; padding:4px 2px 8px;
    }
    .carrossel-track::-webkit-scrollbar{display:none}
    .slide{ flex: 0 0 clamp(300px, 85vw, 440px); }
    .slide{transform:scale(.965); opacity:.86; transition:transform .25s ease, opacity .25s ease}
    .slide.is-active{transform:scale(1); opacity:1}

    .nav{
      position:absolute; top:50%; transform:translateY(-50%);
      width:42px;height:42px;border-radius:999px;border:1px solid var(--border);
      background:rgba(18,18,22,.75); color:var(--text); cursor:pointer; z-index:2;
      display:grid;place-items:center; backdrop-filter:blur(6px);
      transition:transform .15s ease,opacity .15s ease,background .15s ease
    }
    .nav:hover{transform:translateY(-50%) scale(1.05)}
    .nav.prev{left:6px} .nav.next{right:6px}
    @media (max-width:720px){ .nav{display:none} }

    .dots{display:flex;justify-content:center;gap:6px;margin-top:12px}
    .dots button{width:7px;height:7px;border-radius:999px;border:none;background:#5b5b5b66;cursor:pointer}
    .dots button.active{background:#fff}

    /* Responsivo */
    @media (max-width:1100px){ }
    @media (max-width:720px){
      .headline{font-size:clamp(28px, 8.5vw, 40px)}
      .lead{font-size:15.5px}
      .calc{left:20px;right:20px;width:auto}
      :root{ --thumb-ratio:4/3; --thumb-max-h:220px }
      .footer .btn{min-width:0;flex:1 1 48%}
      .specs{grid-template-columns:repeat(2,1fr)}
    }

/* ====== Notícias / Atualizações ====== */
.news { padding-top: 8px; padding-bottom: 32px; }
.news-head { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.news-title { margin:0; font-size:clamp(18px,2.6vw,22px); letter-spacing:-.01em; }

.news-tabs { display:flex; gap:8px; flex-wrap:wrap; }
.chip{
  background:var(--chip); color:var(--text); border:1px solid var(--border);
  padding:8px 10px; border-radius:999px; font-size:13px; cursor:pointer;
}
.chip.active{ outline:2px solid #ffffff18; background:linear-gradient(180deg,#ffffff10,#ffffff05); }

.news-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:14px; margin-top:12px;
}
@media (max-width:1100px){ .news-grid{ grid-template-columns: repeat(2,1fr); } }
@media (max-width:720px){ .news-grid{ grid-template-columns: 1fr; } }

.news-card{
  background:var(--card); border:1px solid var(--border); border-radius:14px;
  overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column;
}
.news-thumb{ aspect-ratio:16/9; background:#0b0b0e; border-bottom:1px solid var(--border); }
.news-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
.news-body{ padding:12px; display:flex; flex-direction:column; gap:8px; }
.news-meta{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px; }
.news-src{ background:var(--chip); border:1px solid var(--border); padding:4px 8px; border-radius:999px; font-size:11px; }
.news-title-sm{ font-size:15px; font-weight:700; line-height:1.25; margin:0; }
.news-desc{ font-size:13px; color:#cfd2d7; opacity:.9; }

.news-foot{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:12px; }
.news-updated{ color:var(--muted); font-size:12px; }

/* Skeleton */
.skeleton{ position:relative; height:160px; border-radius:12px; overflow:hidden; }
.skeleton::before{
  content:""; position:absolute; inset:0; background:linear-gradient(90deg,#ffffff05, #ffffff10, #ffffff05);
  transform:translateX(-100%); animation:skeleton 1.2s infinite;
}
@keyframes skeleton{ to{ transform:translateX(100%);} }


  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="barra-topo">
    <div class="barra-conteudo">
      <a href="/" class="link-barra">Início</a>
      <a href="/pages/leiloes" class="link-barra">Leilão</a>
      <a href="investimento.html" class="link-barra">Investimento</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container narrow hero-wrap">
      <h1 class="headline">
        <span class="line1"><span class="headline-accent">Investimentos</span> do</span>
        <span class="line2">portal de investimento</span>
      </h1>

      <p class="lead">
        Somente imóveis com tese clara. Compare <b>Cap Rate</b>, <b>Yield</b> e <b>Payback</b>.
        Selecione, entenda as métricas e fale com um especialista.
      </p>
      <div class="cta-row">
        <button class="btn primary" id="ctaWhats">Falar com especialista</button>
        <a class="btn ghost" href="#lista">Ver oportunidades</a>
      </div>
    </div>
  </header>

  <!-- LISTA COMO CARROSSEL -->
  <main class="container" id="lista" aria-live="polite">
    <section class="carrossel" aria-label="Oportunidades">
      <button class="nav prev" id="cPrev" aria-label="Anterior">&#10094;</button>
      <div class="carrossel-viewport" id="cViewport">
        <div class="carrossel-track" id="cTrack"></div>
      </div>
      <button class="nav next" id="cNext" aria-label="Próximo">&#10095;</button>
      <div class="dots" id="cDots"></div>
    </section>
  </main>

  <section class="news container" id="news">
  <div class="news-head">
    <h2 class="news-title">Atualizações de mercado</h2>
    <div class="news-tabs" id="newsTabs" role="tablist" aria-label="Filtros de notícias">
      <button class="chip active" data-q="mercado imobiliário investimento">Geral</button>
      <button class="chip" data-q="fundos imobiliários OR FIIs">FIIs</button>
      <button class="chip" data-q="incorporação construção civil imóveis">Construção</button>
      <button class="chip" data-q="aluguel vacância cap rate">Rentabilidade</button>
    </div>
  </div>

  <div class="news-grid" id="newsGrid" aria-busy="true">
    <!-- skeletons -->
    <article class="news-card skeleton"></article>
    <article class="news-card skeleton"></article>
    <article class="news-card skeleton"></article>
  </div>

  <div class="news-foot">
    <span class="news-updated" id="newsUpdated" aria-live="polite"></span>
    <a class="btn ghost" id="newsMore" target="_blank" rel="noopener">Ver mais</a>
  </div>
</section>


  <!-- FAB + Modal Calculadora -->
  <button class="fab" id="btnFabCalc" aria-expanded="false" aria-controls="calcModal" title="Abrir calculadora">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <rect x="4" y="3" width="16" height="18" rx="2"/>
      <line x1="8" y1="7" x2="16" y2="7"/><line x1="8" y1="11" x2="8" y2="11"/>
      <line x1="12" y1="11" x2="12" y2="11"/><line x1="16" y1="11" x2="16" y2="11"/>
      <line x1="8" y1="15" x2="8" y2="15"/><line x1="12" y1="15" x2="12" y2="15"/><line x1="16" y1="15" x2="16" y2="15"/>
    </svg>
    Calculadora
  </button>
  <div class="overlay" id="calcOverlay" aria-hidden="true"></div>

  <aside class="calc" id="calcModal" role="dialog" aria-modal="true" aria-label="Calculadora de investimento">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px">
      <h3 style="margin:0;font-size:16px">Calculadora rápida</h3>
      <button class="btn" id="btnCloseCalc" aria-label="Fechar calculadora">Fechar</button>
    </div>
    <div class="row">
      <input class="input" id="cPreco" type="number" placeholder="Preço" />
      <input class="input" id="cAluguel" type="number" placeholder="Aluguel estimado" />
    </div>
    <div class="row" style="margin-top:8px">
      <input class="input" id="cCondo" type="number" placeholder="Condomínio" />
      <input class="input" id="cIptu" type="number" placeholder="IPTU mensal" />
    </div>
    <div class="row" style="margin-top:8px">
      <input class="input" id="cVacancia" type="number" step="0.5" placeholder="Vacância % (ex. 5)" />
      <input class="input" id="cCustos" type="number" step="0.5" placeholder="Custos adm % (ex. 10)" />
    </div>
    <button class="btn" id="btnCalc" style="margin-top:8px">Calcular</button>
    <div class="result" id="calcOut">Cap Rate: -- | Yield: -- | Payback: -- anos</div>
  </aside>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11359273530"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-11359273530');
  </script>

  <script>
    // === Utils ===
    const brl = v => (v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const pct = v => `${(v||0).toFixed(1)}%`;
    const by  = (sel, el=document) => el.querySelector(sel);
    const all = (sel, el=document) => [...el.querySelectorAll(sel)];

    // Fórmulas
    function grossYield(aluguel, preco){ return (aluguel*12)/preco*100 }
    function netIncomeMes(aluguel, condo, iptu, vac=5, adm=10){
      const vacancia = aluguel*(vac/100);
      const taxaAdm = aluguel*(adm/100);
      return Math.max(0, aluguel - condo - iptu - vacancia - taxaAdm);
    }
    function capRate(preco, rendaLiquidaMes){ return (rendaLiquidaMes*12)/preco*100 }
    function paybackAnos(preco, rendaLiquidaMes){ return rendaLiquidaMes>0 ? (preco/(rendaLiquidaMes*12)) : Infinity }

    function statusFor(type, v){
      if (type === 'cap')   return v >= 6.5 ? 'good' : v >= 5.0 ? 'warn' : 'bad';
      if (type === 'yield') return v >= 8.0 ? 'good' : v >= 6.5 ? 'warn' : 'bad';
      if (type === 'pay')   return v <= 14  ? 'good' : v <= 18  ? 'warn' : 'bad';
      return '';
    }

    // ==== Carregamento do JSON (sem cache) ====
    const JSON_URL = 'imóveis/investimento/investimento.json'; // ajuste conforme seu deploy
    const SAMPLE = [
      { id:"POA-CB-001", titulo:"Loft mobiliado próximo à UFRGS", cidade:"Porto Alegre", bairro:"Cidade Baixa", tipo:"Kitnet/Loft", area:38, vagas:1, preco:368800, aluguel_est:2300, condominio:450, iptu_mensal:42, perfil:["Comprar para alugar","Alto rendimento"], url:"/imoveis/POA-CB-001", imagem:"https://images.unsplash.com/photo-1523217582562-09d0def993a6?q=80&w=1200&auto=format&fit=crop", desconto_percentual:8 },
      { id:"CNO-HM-214", titulo:"2D reformado – próximo ao trem", cidade:"Canoas", bairro:"Centro", tipo:"Apartamento", area:54, vagas:1, preco:289000, aluguel_est:2000, condominio:350, iptu_mensal:35, perfil:["Preço baixo","Comprar para alugar"], url:"/imoveis/CNO-HM-214", imagem:"https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=1200&auto=format&fit=crop", desconto_percentual:12 },
      { id:"FLN-SC-310", titulo:"Sala comercial – Beira-Mar", cidade:"Florianópolis", bairro:"Centro", tipo:"Sala/Conjunto", area:32, vagas:1, preco:380000, aluguel_est:2600, condominio:590, iptu_mensal:70, perfil:["Revenda","Comprar para alugar"], url:"/imoveis/FLN-SC-310", imagem:"https://images.unsplash.com/photo-1448630360428-65456885c650?q=80&w=1200&auto=format&fit=crop", desconto_percentual:5 }
    ];
    let DATA = SAMPLE;

    async function loadData(){
      try{
        const res = await fetch(`${JSON_URL}?t=${Date.now()}`, {cache:'no-store'});
        if(res.ok){
          const arr = await res.json();
          if(Array.isArray(arr) && arr.length) DATA = arr;
        }else{
          console.warn('Falha ao carregar JSON:', res.status, res.statusText);
        }
      }catch(err){
        console.warn('Erro ao carregar JSON:', err);
      }
    }

    // ===== Carrossel render =====
    function sortList(list){ return list.sort((a,b)=> {
      const ma = computeMetrics(a), mb = computeMetrics(b);
      return mb.cap - ma.cap;
    });}
    function computeMetrics(item){
      const rendaMes = netIncomeMes(item.aluguel_est, item.condominio, item.iptu_mensal);
      const cap = capRate(item.preco, rendaMes);
      const y = grossYield(item.aluguel_est, item.preco);
      const pay = paybackAnos(item.preco, rendaMes);
      return { rendaMes, cap, y, pay };
    }

    function render(){
      const viewport = by('#cViewport');
      const track    = by('#cTrack');
      const dotsWrap = by('#cDots');

      const list = sortList(DATA.slice());
      if(!list.length){ track.innerHTML = `<div style="opacity:.8">Nenhum imóvel encontrado.</div>`; return; }

      const cardHtml = (i, it) => {
        const m = computeMetrics(it);
        const sqm = it.area ? it.preco/it.area : 0;
        const abaixo = (it.desconto_percentual||0) >= 10;
        return `
        <article class="card slide" data-real-index="${i}">
          <div class="thumb">
            <img loading="lazy" src="${it.imagem}" alt="${it.titulo}">
            <div class="labels">
              <div class="label-left">
                ${abaixo?`<span class="badge ok">Abaixo do mercado -${it.desconto_percentual}%</span>`:''}
              </div>
              <div class="label-right">${(it.perfil||[]).map(p=>`<span class="b">${p}</span>`).join('')}</div>
            </div>
          </div>
          <div class="body">
            <div class="h">
              <div class="price">${brl(it.preco)}</div>
              <h3 class="title">${it.titulo}</h3>
            </div>
            <div class="loc">${it.bairro} • ${it.cidade}</div>

            <div class="specs">
              <div class="spec"><span class="label">Tipo</span><span class="value">${it.tipo||'-'}</span></div>
              <div class="spec"><span class="label">Área</span><span class="value">${it.area||'-'} m²</span></div>
              <div class="spec"><span class="label">Vagas</span><span class="value">${it.vagas||0}</span></div>
              <div class="spec"><span class="label">R$/m²</span><span class="value">${(sqm).toFixed(0)}</span></div>
            </div>

            <div class="returns">
              <div class="ret ${statusFor('cap', m.cap)}" data-tip="Cap Rate = renda líquida anual ÷ preço">
                <span class="label">Cap</span>
                <span class="value">${pct(m.cap)}</span>
                <div class="bar"><span style="width:0%"></span></div>
              </div>
              <div class="ret ${statusFor('yield', m.y)}" data-tip="Yield bruto = aluguel anual ÷ preço">
                <span class="label">Yield</span>
                <span class="value">${pct(m.y)}</span>
                <div class="bar"><span style="width:0%"></span></div>
              </div>
              <div class="ret ${statusFor('pay', m.pay)}" data-tip="Payback ≈ anos para retorno (menor é melhor)">
                <span class="label">Payback</span>
                <span class="value">${m.pay===Infinity?'—':m.pay.toFixed(1)+'a'}</span>
                <div class="bar"><span style="width:0%"></span></div>
              </div>
            </div>

            <div class="footer">
              <a class="btn" href="${it.url}" target="_blank" rel="noopener">Ver detalhes</a>
              <button class="btn whats" data-whats>
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M20.52 3.48A11.87 11.87 0 0 0 12.02 0C5.73 0 .64 5.09.64 11.38c0 2 .53 3.95 1.53 5.67L0 24l7.18-2.1a11.38 11.38 0 0 0 4.84 1.08h.01c6.29 0 11.38-5.09 11.38-11.38 0-3.04-1.18-5.9-3.39-8.12ZM12.02 21.2h-.01a9.9 9.9 0 0 1-5.05-1.39l-.36-.21-4.26 1.25 1.26-4.15-.24-.43a9.9 9.9 0 0 1-1.4-5.09c0-5.48 4.46-9.94 9.95-9.94 2.66 0 5.16 1.04 7.04 2.93a9.9 9.9 0 0 1 2.92 7.03c0 5.48-4.46 9.94-9.95 9.94Zm5.46-7.42c-.3-.15-1.77-.87-2.04-.97-.27-.1-.47-.15-.67.15-.2.3-.77.96-.95 1.15-.18.2-.35.22-.65.08-.3-.15-1.26-.46-2.4-1.46-.89-.78-1.49-1.75-1.66-2.05-.17-.3-.02-.47.13-.62.13-.13.3-.35.45-.52.15-.18.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.67-1.6-.92-2.2-.24-.58-.5-.5-.67-.5-.17 0-.37-.02-.57-.02s-.52.07-.79.37c-.27.3-1.04 1.02-1.04 2.47 0 1.45 1.07 2.85 1.22 3.04.15.2 2.1 3.2 5.08 4.49.71.31 1.26.5 1.7.64.71.23 1.36.2 1.87.12.57-.08 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.07-.12-.27-.2-.57-.35Z"/>
                </svg>
                WhatsApp
              </button>
            </div>
          </div>
        </article>`;
      };

      // clones nas pontas para loop infinito
      const CLONES = 2;
      const slides = list.map((it, i) => cardHtml(i, it));
      const head = slides.slice(-CLONES).join('');
      const tail = slides.slice(0, CLONES).join('');
      track.innerHTML = head + slides.join('') + tail;

      // dots
      dotsWrap.innerHTML = list.map((_,i)=>`<button aria-label="Ir para slide ${i+1}"></button>`).join('');

      let current = CLONES;
      let total   = list.length;
      const children = [...track.children];

      function goTo(idx, smooth=true){
        const el = children[idx];
        if(!el) return;
        const left = el.offsetLeft - children[0].offsetLeft;
        by('#cViewport').scrollTo({ left, behavior: smooth ? 'smooth' : 'auto' });
        setActive(idx);
      }

      function setActive(idx){
        children.forEach(c=>c.classList.remove('is-active'));
        (children[idx]||{}).classList?.add('is-active');
        const logical = ((idx - CLONES) % total + total) % total; // 0..total-1
        [...dotsWrap.children].forEach((d,i)=>d.classList.toggle('active', i===logical));
        current = idx;
      }

      requestAnimationFrame(()=>goTo(current,false));

      by('#cNext')?.addEventListener('click', ()=> goTo(current+1));
      by('#cPrev')?.addEventListener('click', ()=> goTo(current-1));
      [...dotsWrap.children].forEach((dot,i)=> dot.addEventListener('click',()=> goTo(CLONES+i)));

      // corrige quando chega nos clones
      let scrollTimer=null;
      by('#cViewport').addEventListener('scroll', ()=>{
        clearTimeout(scrollTimer);
        scrollTimer=setTimeout(()=>{
          const viewport = by('#cViewport');
          const center = viewport.scrollLeft + viewport.clientWidth/2;
          let nearest = 0, dMin = Infinity;
          children.forEach((el,idx)=>{
            const mid = el.offsetLeft + el.offsetWidth/2;
            const d = Math.abs(mid - center);
            if(d < dMin){ dMin = d; nearest = idx; }
          });
          current = nearest;

          if (current >= total + CLONES){
            goTo(CLONES + (current - (total + CLONES)), false);
          } else if (current < CLONES){
            goTo(total + current, false);
          } else {
            setActive(current);
          }
        }, 80);
      });

      // WhatsApp (delegate — funciona com clones)
      track.addEventListener('click', (e)=>{
        const btn = e.target.closest('[data-whats]');
        if(!btn) return;
        const slide = btn.closest('.slide');
        const idxReal = Number(slide?.dataset?.realIndex || 0);
        const item = list[idxReal];
        const fone = (item.whatsapp||"5551994061787");
        const msg  = encodeURIComponent(`Olá! Tenho interesse no imóvel ${item.id} (${item.titulo}) em ${item.cidade}. Podemos falar?`);
        window.open(`https://wa.me/${fone}?text=${msg}`, '_blank');
        if(window.dataLayer){ dataLayer.push({event:'invest_whats', id:item.id, cidade:item.cidade}); }
      });

      window.addEventListener('resize', ()=> goTo(current,false));
    }

    // CTA topo + Calculadora
    function bindControls(){
      by('#ctaWhats')?.addEventListener('click', ()=>{
        const msg = encodeURIComponent('Olá! Quero ajuda para escolher um imóvel de investimento.');
        window.open(`https://wa.me/5551994061787?text=${msg}`,'_blank');
      });

      by('#btnCalc')?.addEventListener('click', ()=>{
        const p = Number(by('#cPreco').value||0);
        const a = Number(by('#cAluguel').value||0);
        const c = Number(by('#cCondo').value||0);
        const i = Number(by('#cIptu').value||0);
        const v = Number(by('#cVacancia').value||5);
        const u = Number(by('#cCustos').value||10);

        const renda = Math.max(0, netIncomeMes(a,c,i,v,u));
        const cap = capRate(p, renda);
        const y   = grossYield(a,p);
        const pb  = paybackAnos(p, renda);

        const capPct = Math.min(100, Math.max(0, (cap/10)*100));
        const yPct   = Math.min(100, Math.max(0, (y/12)*100));
        const payPct = (pb===Infinity) ? 0 : Math.min(100, Math.max(0, (1-(pb/25))*100));

        by('#calcOut').innerHTML = `
          <div class="res-grid">
            <div class="ret ${statusFor('cap', cap)}" data-tip="Cap Rate = renda líquida anual ÷ preço">
              <span class="label">Cap</span>
              <span class="value">${pct(cap)}</span>
              <div class="bar"><span style="width:${capPct}%"></span></div>
            </div>
            <div class="ret ${statusFor('yield', y)}" data-tip="Yield bruto = aluguel anual ÷ preço">
              <span class="label">Yield</span>
              <span class="value">${pct(y)}</span>
              <div class="bar"><span style="width:${yPct}%"></span></div>
            </div>
            <div class="ret ${statusFor('pay', pb)}" data-tip="Payback ≈ anos para retorno (menor é melhor)">
              <span class="label">Payback</span>
              <span class="value">${pb===Infinity?'—':pb.toFixed(1)+'a'}</span>
              <div class="bar"><span style="width:${payPct}%"></span></div>
            </div>
          </div>
          <div class="note">Renda líquida estimada: <b>${brl(renda)}</b>/mês</div>
        `;
      });

      const fab = by('#btnFabCalc'), modal = by('#calcModal'), overlay = by('#calcOverlay'), close = by('#btnCloseCalc');
      const openCalc = ()=>{ modal.classList.add('open'); overlay.classList.add('visible'); fab?.setAttribute('aria-expanded','true'); }
      const closeCalc = ()=>{ modal.classList.remove('open'); overlay.classList.remove('visible'); fab?.setAttribute('aria-expanded','false'); }
      fab?.addEventListener('click', ()=> modal.classList.contains('open')? closeCalc(): openCalc());
      close?.addEventListener('click', closeCalc);
      overlay?.addEventListener('click', closeCalc);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeCalc(); });
    }

    // ========= Notícias =========
  const NEWS_API = '/api/news';             // endpoint (abaixo te dou 2 opções)
  const NEWS_FALLBACK = '/dados/news.json'; // fallback local (opcional)
  const NEWS_SAMPLE = [
    {title:'Volume financeiro do setor imobiliário no mercado de capitais cresce 5% até junho',
     link:'https://www.infomoney.com.br/economia/mercado-de-capitais-imobiliario-selic-cvm/', src:'economia', pubDate:new Date().toISOString(),
     description:'O mercado de capitais é visto como uma das alternativas para compor os recursos do funding imobiliário, em meio à queda da captação da poupança e do alto volume de saques',
     image: 'https://www.infomoney.com.br/wp-content/uploads/2025/06/tierra-mallorca-NpTbVOkkom8-unsplash.jpg?w=640&quality=70&strip=all'
},
    
     {title:'Funding Imobiliário: LCI muda ponteiro da precificação do crédito imobiliário',
     link:'https://www.infomoney.com.br/economia/funding-imobiliario-lci-muda-ponteiro-da-precificacao-do-credito-imobiliario/', src:'Mercado Imobiliário', pubDate:new Date().toISOString(),
     description:'Sandro Gamba, presidente da Abecip, falou durante seminário de funding imobiliário, com a participação de representantes de bancos',
    image: 'https://www.infomoney.com.br/wp-content/uploads/2025/06/AdobeStock_1167966353.jpg?w=1280&quality=70&strip=all'
}
  ];

  function timeAgo(iso){
    const d = new Date(iso); const diff = (Date.now()-d.getTime())/1000;
    const h = Math.floor(diff/3600), m = Math.floor((diff%3600)/60);
    if (h>0) return `${h}h${m?` ${m}m`:''} atrás`;
    return `${Math.max(1,m)} min atrás`;
  }

  async function fetchNews(q){
    const url = `${NEWS_API}?q=${encodeURIComponent(q||'mercado imobiliário investimento')}`;
    try{
      const r = await fetch(url, {cache:'no-store'});
      if (!r.ok) throw new Error('bad status');
      const j = await r.json();
      if (Array.isArray(j.items) && j.items.length) return j.items;
      throw new Error('empty');
    }catch(e){
      // fallback local
      try{
        const r2 = await fetch(`${NEWS_FALLBACK}?t=${Date.now()}`, {cache:'no-store'});
        if (r2.ok){ const j2 = await r2.json(); if (Array.isArray(j2.items)) return j2.items; }
      }catch(_){}
      return NEWS_SAMPLE.map(x=>({...x}));
    }
  }

  function renderNews(items){
    const grid = document.getElementById('newsGrid');
    const upd = document.getElementById('newsUpdated');
    grid.setAttribute('aria-busy','false');
    grid.innerHTML = items.slice(0,9).map(i=>`
      <article class="news-card">
        <a class="news-thumb" href="${i.link}" target="_blank" rel="noopener">
          ${i.image ? `<img src="${i.image}" alt="">` : ''}
        </a>
        <div class="news-body">
          <div class="news-meta">
            <span class="news-src">${i.src||''}</span>
            <span>${i.pubDate? timeAgo(i.pubDate):''}</span>
          </div>
          <h3 class="news-title-sm"><a href="${i.link}" target="_blank" rel="noopener">${i.title}</a></h3>
          ${i.description? `<div class="news-desc">${i.description}</div>`:''}
        </div>
      </article>
    `).join('');
    const more = document.getElementById('newsMore');
    more.href = `https://news.google.com/search?q=${encodeURIComponent(currentQ)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;
    upd.textContent = `Atualizado ${timeAgo(new Date().toISOString())}`;
  }

  let currentQ = 'mercado imobiliário investimento';
  async function loadNews(q){
    currentQ = q || currentQ;
    document.getElementById('newsGrid').setAttribute('aria-busy','true');
    const items = await fetchNews(currentQ);
    renderNews(items);
  }

  // tabs
  document.getElementById('newsTabs')?.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-q]'); if(!btn) return;
    [...e.currentTarget.querySelectorAll('.chip')].forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); loadNews(btn.dataset.q);
  });

  // carrega inicial
  loadNews();

    // Boot
    (async function init(){
      bindControls();
      await loadData();   // tenta puxar o JSON sempre que abre (sem cache)
      render();
    })();

  </script>
</body>
</html>